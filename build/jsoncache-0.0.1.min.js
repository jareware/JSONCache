/*
 JSONCache version 0.0.1

 Author: Kimmo Puputti (kpuputti at gmail)

 See README.rst at https://github.com/kpuputti/JSONCache
 for requirements and usage.
*/
(function(k){var d={version:"0.0.1",debug:!0,prefix:"JSONCache"},g=function(){if(d.debug&&window.console){var b=Array.prototype.slice.call(arguments);b.unshift("JSONCache:");console.log.apply(console,b)}};d.browserOk=function(){var b=window.JSON&&typeof window.JSON.parse==="function"&&typeof window.JSON.stringify==="function",a;try{a="localStorage"in window&&window.localStorage!==null}catch(d){a=!1}return b&&a}();var i=function(b,a){try{window.localStorage[b]=a}catch(d){g("Error adding data to localStorage, quota might be full.")}},
c={};c.settings=d;c.clear=function(b){if(b)window.localStorage.removeItem(d.prefix+" data "+b),window.localStorage.removeItem(d.prefix+" time "+b);else{var b=RegExp("^"+d.prefix+" (data|time) "),a,c,e=window.localStorage.length,f=[];for(a=0;a<e;++a)c=window.localStorage.key(a),b.test(c)&&f.push(c);e=f.length;for(a=0;a<e;++a)window.localStorage.removeItem(f[a])}};c._getJSONProxy=function(b,a){k.ajax(b,a)};c._getTime=function(){return(new Date).getTime().toString()};c.getCachedJSON=function(b,a){(new Date).getTime();
var h=a.success,e=d.prefix+" data "+b,f=d.prefix+" time "+b,j=window.localStorage[e];j?(g("Value found from cache for url:",b),h(JSON.parse(j))):(g("Value not found in cache fetching data from url:",b),a.success=function(a){g("Fetched data, adding to cache for url:",b);i(e,JSON.stringify(a));i(f,c._getTime());h(a)},a.dataType="json",c._getJSONProxy(b,a))};window.JSONCache=c})(jQuery);
