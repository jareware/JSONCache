/*
 JSONCache version 0.0.1

 Author: Kimmo Puputti (kpuputti at gmail)

 See README.rst at https://github.com/kpuputti/JSONCache
 for requirements and usage.
*/
(function(l){var g={version:"0.0.1",debug:!0,prefix:"JSONCache"},h=function(){if(g.debug&&window.console){var b=Array.prototype.slice.call(arguments);b.unshift("JSONCache:");console.log.apply(console,b)}};g.browserOk=function(){var b=window.JSON&&typeof window.JSON.parse==="function"&&typeof window.JSON.stringify==="function",a;try{a="localStorage"in window&&window.localStorage!==null}catch(c){a=!1}return b&&a}();var j=function(b,a){try{window.localStorage[b]=a}catch(c){h("Error adding data to localStorage, quota might be full.")}},
d={};d.settings=g;d.clear=function(b){if(b)window.localStorage.removeItem(g.prefix+" data "+b),window.localStorage.removeItem(g.prefix+" time "+b);else{var b=RegExp("^"+g.prefix+" (data|time) "),a,c,e=window.localStorage.length,f=[];for(a=0;a<e;++a)c=window.localStorage.key(a),b.test(c)&&f.push(c);e=f.length;for(a=0;a<e;++a)window.localStorage.removeItem(f[a])}};d.purgeOldest=function(){for(var b=RegExp("^"+g.prefix+" time "),a,c=null,e,f,d=window.localStorage.length,i=0;i<d;++i)if(e=window.localStorage.key(i),
b.test(e)&&(f=parseInt(window.localStorage[e],10),!isNaN(f)&&(c===null||f<c)))a=e,c=f;c!==null&&(window.localStorage.removeItem(a.replace(" time "," data ")),window.localStorage.removeItem(a))};d._getJSONProxy=function(b,a){l.ajax(b,a)};d._getTime=function(){return(new Date).getTime().toString()};d.getCachedJSON=function(b,a){(new Date).getTime();var c=a.success,e=g.prefix+" data "+b,f=g.prefix+" time "+b,k=window.localStorage[e];k?(h("Value found from cache for url:",b),c(JSON.parse(k))):(h("Value not found in cache fetching data from url:",
b),a.success=function(a){h("Fetched data, adding to cache for url:",b);j(e,JSON.stringify(a));j(f,d._getTime());c(a)},a.dataType="json",d._getJSONProxy(b,a))};window.JSONCache=d})(jQuery);
